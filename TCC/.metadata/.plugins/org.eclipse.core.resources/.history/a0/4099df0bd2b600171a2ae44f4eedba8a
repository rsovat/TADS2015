package scanner;

import java.util.Vector;

import javax.bluetooth.DiscoveryAgent;
import javax.bluetooth.RemoteDevice;
import javax.bluetooth.UUID;

import bluetooth.DiscoveryDevices;

public class ConnectToDevice {
	private DiscoveryDevices discoveryDevices;
	private DiscoveryAgent discoveryAgent;
	private Vector remoteDevices;
	private Object lock;
	
	public ConnectToDevice() {
		discoveryDevices = new DiscoveryDevices();
		discoveryAgent = discoveryDevices.getDiscoveryAgent();
		remoteDevices = discoveryDevices.getRemoteDevices();
		lock = discoveryDevices.getLock();
	}
	
	public ELM327 connectToDevice(int index) {
		ELM327 scanner;
		RemoteDevice des_device=(RemoteDevice)remoteDevices.elementAt(index);
        UUID[] uuidset=new UUID[1];
        uuidset[0]=new UUID("1101",true);

        discoveryAgent.searchServices(null, uuidset, des_device, this);
        try
        {
            synchronized(lock)
            {
                lock.wait();
            }
        }
        catch(InterruptedException e)
        {
            e.printStackTrace();
        }

        if(connectionUrl==null)
        {
            System.out.println("Device does not support SPP.");
            labelStatus.carregarElemento("Device does not support SPP.");
        }
        else
        {
            System.out.println("Device supports SPP.");
            objectConnection = ConnectionFactory.getConnectionBluetooth(connectionUrl);
            outStream = objectConnection.openOutputStream();
    		inStream = objectConnection.openInputStream();
            labelStatus.carregarElemento("Device supports SPP.");
        }
		return scanner;
	}
}
